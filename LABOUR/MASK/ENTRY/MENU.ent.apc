{Application 'MENU' logic file generated by CSPro}
PROC GLOBAL
numeric ok, numlang, som, i, ChoixLogiciel, pas, j, cur, err, col, t, g, k, enq, n, x, ligne;
string AgentCode, accreditation, temp, numHH, OperatorCode, pourTablette, wrkprj, floppy;
array nbHHAssigned(900);
string ftpServerUrl, username, password, slash, sdcard1, sdcard, app1, TheCommand;
string goog,wdir,result1,statut, nomCM, idQuest,reportt,color1;
file piffile, tempfile, FileAgentCode;
array MenageSelectionnes(48);
array V1(6000);
array V2(6000);
array code(5000);
array string label(5000);
array nbMenAssigne(5000);   
array string XV1(200,9); //we say that we have a maximum of 200 households assigned to an interviewer in a cluster
list string IdFollow;

alpha(20) result;
alpha(30) FNAMExx;
alpha(3) FSIZExx;

valueset valset;
list string setReg, setDep ;

function OperatorMenu1()
	//Dynamic valuesets for supervisor and interviewer Group of options
	valueset CodesOptions;
	CodesOptions = GOPT_VS1;
	
	if accreditation = "supervisor" then
		//nothing
	ELSEif accreditation = "interviewer" then
		CodesOptions.remove(0); //interviewer cannot assign households
	ELSEif accreditation = "coordo" then
		CodesOptions.remove(0); //
		CodesOptions.remove(1); //
		CodesOptions.remove(5); //
		CodesOptions.remove(6); //
		CodesOptions.remove(7); //
		CodesOptions.remove(8); //
	endif;
	
	setvalueset(GOPT,CodesOptions);

end;

function OperatorMenu()
	//we define the options according to the level of accreditation
	valueset CodesOptions;
	CodesOptions = OPTION_VS1;
	
	//we reduce the list to the codes starting with the digit selected at GOPT
	do i = 1 while i<= length(OPTION_VS1.codes)
		if tonumber(edit("99",OPTION_VS1.codes(i))[1:1]) <> GOPT then
			CodesOptions.remove(OPTION_VS1.codes(i));
		endif;
	enddo;
	
	//we remove the options that do not concern certain stakeholders
	if accreditation = "supervisor" then
		CodesOptions.remove(31);
		CodesOptions.remove(36);
	
	elseif accreditation = "interviewer" then
		CodesOptions.remove(3);
		CodesOptions.remove(30);
		CodesOptions.remove(33);
		CodesOptions.remove(34);
		CodesOptions.remove(36);
	elseif accreditation = "coordo" then
		CodesOptions.clear();
		CodesOptions.add(getlabel(OPTION_VS1,33),33);
		CodesOptions.add(getlabel(OPTION_VS1,36),36);
		CodesOptions.add(getlabel(OPTION_VS1,90),90);
		

	endif;
	setvalueset(OPTION,CodesOptions);
end;


function onchangelanguage()
	//to update the valueset of GOPT if the operator change language
	OperatorMenu1();
end;


function genpff1(string app) //function to assign households
	SetFile( piffile, temp + app + ".pff",create) ;
		Filewrite (piffile, "[Run Information]");
		Filewrite (piffile, "Version=CSPro 7.7");
		Filewrite (piffile, "AppType=Entry");		
		Filewrite (piffile, "[DataEntryInit]");
		Filewrite (piffile, "OperatorID=Anyone");
		Filewrite (piffile, "StartMode=ADD;"+edit("9999999",CNULSAMP));
		Filewrite (piffile, "Lock=Modify,Verify");
		Filewrite (piffile, "FullScreen=YES");
		Filewrite (piffile, "NoFileOpen=Yes");	
		Filewrite (piffile, "ShowInApplicationListing=Hidden");							
		Filewrite (piffile, "[Files]");
		Filewrite (piffile, "Application= " + "../ENTRY/" + app + ".pen");
		Filewrite (piffile, "InputData= " + "../REF/" + "sample.dat");
		Filewrite (piffile, "[ExternalFiles]");
		Filewrite (piffile, "FOLLOW_DICT= " + "../REF/" + "follow.dat");
    close( piffile );
 end; 

function genpff3(string app) //fonction pour entamer l'interview
	
	SetFile( piffile, temp + app + ".pff",create) ;
		Filewrite (piffile, "[Run Information]");
		Filewrite (piffile, "Version=CSPro 7.7");
		Filewrite (piffile, "AppType=Entry");		
		Filewrite (piffile, "[DataEntryInit]");
		Filewrite (piffile, "OperatorID=Anyone");
		FileWrite( piffile, "ShowInApplicationListing = hidden" );		
		Filewrite (piffile, "StartMode=ADD;" + edit("9999999",CNULSAMP) + numHH);
		Filewrite (piffile, "Lock=ADD,Verify");
		Filewrite (piffile, "AutoAdd=No");
		Filewrite (piffile, "FullScreen=No");
		Filewrite (piffile, "NoFileOpen=Yes");		
		Filewrite (piffile, "[Files]");
		Filewrite (piffile, "Application= " + "../ENTRY/" + app + ".pen");
		Filewrite (piffile, "InputData= " + "../DATA/" + "M" + OperatorCode + edit("9999999",CNULSAMP) + ".csdb");
		Filewrite (piffile, "CommonStore=.\MySettings.db");
		Filewrite (piffile, "[ExternalFiles]");
	
	   close(SAMPLE_DICT);
	   setfile(SAMPLE_DICT,"../REF/sample.dat");
	   loadcase(SAMPLE_DICT,CNULSAMP);
		Filewrite (piffile, "[Parameters]");
		Filewrite (piffile, "cluster = " + maketext("%d",CNULSAMP));
		Filewrite (piffile, "HHnumber = " + numHH);
		Filewrite (piffile, "interviewer = " + OperatorCode);
		Filewrite (piffile, "LGA = " + maketext("%d",XLGA));
		Filewrite (piffile, "AREA = " + maketext("%d",XAREA));
		Filewrite (piffile, "SANNA = CSPRO MASTER" );
		if getos() = 20 then Filewrite (piffile, "OnExit=.\Menu.pff"); endif;
	   close(SAMPLE_DICT);
	close( piffile );
 end;
 
  { Runs a .PFF for an application }
function runpff( string app);
    { Using single quotes instead of double quotes as double quotes are needed in the string generated }

    if getos() in 20:29 then 
    	execPFF (temp + app + ".pff",stop); //sous android on ne peut pas avoir 2 applications .pen ouvertes simultanément, c'est pourquoi il faut stopper la 1ère   	
    else 
    	execPFF (temp + app + ".pff"); 
    endif;
end;



function string couleur(xxx)
	if xxx = 0 then couleur = "red" else couleur = "black"; endif;
end;


function ResultHH()
	//this function is used to display the household interview result in the OP_select function
	alpha(9) idHH = maketext("%07d%02d",FCLUSTER,FNUMBER);
	FNAMExx = FNAME; FSIZExx = edit("ZZ9",FSIZE); if FSIZE >=95 then FSIZExx = "DK"; endif;
	if locate(LFS_DICT,=,idHH) and retrieve(LFS_DICT) then
		//We retrieve the result in the data file
		if HH11 = notappl then
			result1 = ">> In progress";
		elseif BADCLOSEDHH = 0 then
			result1 = "☻ Bad closed";
		elseif HH11 = 1 then
			result1 = "✔ Completed";		
		elseif HH11 in 2,3 then
			result1 = "☻ Absence";
		elseif HH11 = 4 then
			result1 = "☻ Refused";		
		elseif HH11 = 5 then
			result1 = "☻ Postponed";		
		elseif HH11 in 6:8 then
			result1 = "☻ Dwelling...";
		elseif HH11 = 96 then
			result1 = "☻ Other";
		endif;
		
		//We update the information of the map from that of the household file
		if HHSIZE <> Notappl then	FSIZExx = edit("ZZ9",HHSIZE); endif;
		if strip(HH5A) <> "" then FNAMExx = HH5A; endif;
	else
		result1 = tr("Ø Not started");
	endif;
	// ✔ ☺ ☻ Ø  ±
end;

function ListAssignment (string x1,x2,string x3, x4, string x5,x6,x7,string x8);
 //this function will allow to load a matrix which will be displayed for the selection of the household
	inc(ligne);
	XV1(ligne,1) = x1;
	XV1(ligne,2) = maketext("%d",x2);
	XV1(ligne,3) = x3;
	XV1(ligne,4) = maketext("%d",x4);
	XV1(ligne,5) = x5;
	XV1(ligne,6) = maketext("%f",x6); 
	XV1(ligne,7) = maketext("%f",x7);
	XV1(ligne,8) = x8;	
end;
 //  selection of the household to be interviewed
function op_select();
	//We associate the files with the dictionaries that will be used
	ligne = 0;
	CLOSE(FOLLOW_DICT);
	Filedelete("../REF/follow.dat.csidx");
	setfile(FOLLOW_DICT,"../REF/follow.dat");
	close(LFS_DICT);
	filecopy(maketext("../DATA/M%s%07d.csdb",OperatorCode,Cnulsamp),maketext("../WORK/M%s%07d.csdb",OperatorCode,Cnulsamp));
	CLOSE(LFS_DICT);
	setfile(LFS_DICT,maketext("../WORK/M%s%07d.csdb",OperatorCode,Cnulsamp),append);
	
	if countcases(FOLLOW_DICT where FCLUSTER=Cnulsamp and FINTCODE = userCode) = 0 then
		errmsg("No household assigned to %s in cluster %07d", getlabel(userCode,userCode),CNULSAMP );      
		reenter;
	
	else //at least 1 household has been assigned to this agent in the cluster
		XV1.clear();  
		IdFollow.clear();

		//We take the households from the assignment file
		forcase FOLLOW_DICT where FCLUSTER=Cnulsamp and FINTCODE = tonumber(OperatorCode) do
			ResultHH(); 
			ListAssignment(result1,FNUMBER,FNAMExx,FPHONE,FSIZExx,FLONGITUDE,FLATITUDE,FLODGING);
			IdFollow.add(maketext("%07d%02d",FCLUSTER,FNUMBER)); 
		endfor;
	endif;
	
	ok = 2;
	do while ok = 2
		k = showarray(maketext(TR("To start or modify a questionnaire, please select a household in the cluster: %07d"), CNULSAMP),
				XV1,
				title("RESULT", "N°SEQ", "HH NAME", "PHONE", "SIZE","LONGITUDE","LATITUDE", "LOCATION") );
		if k = 0 then 
			reenter;
		else 
			ok = accept(maketext("Here is what you have selected: Household # %s, Head of Household = %s, do you want to continue?",strip(XV1(k,2)),strip(XV1(k,3))),"Yes","No, Correct my choice","No, Cancel","Display on map");
			if ok = 0 then
				reenter;
			elseif ok = 1 then
				alpha(9) idHH = IdFollow(k); 
				if locate (FOLLOW_DICT,=,idHH) and retrieve(FOLLOW_DICT) then
					numHH = edit("99",FNUMBER);
				endif;
			elseif ok = 3 then //Cancel
				reenter;
			elseif ok = 4 then //Display on the map
				if tonumber(strip(XV1(k,6))) > 0 or tonumber(strip(XV1(k,6))) < 0 then //we test if there are GPS coordinates
					// execsystem(maketext("gps:%s,%s,%s",strip(XV1(k,8)), strip(XV1(k,7)), strip(XV1(k,3)) ));
					execsystem(maketext("gps:%s,%s",strip(XV1(k,7)), strip(XV1(k,6)) ));
					reenter;
				else //if there are not GPS coordinates
					errmsg("No GPS coordinates available from the household listing");
					reenter;
				endif;
			endif;
		endif;	
	enddo;
 end; 


function  ClientBluetooth(string Type, string FolderOrFile1, string FolderOrFile2, string message); 
	//this function allows the transfer by bluetooth. Type takes the values get or put, FolderOrFile1 is depending on whether type is get or put, source or destination folder
	if syncconnect(Bluetooth) then		
		if tolower(type) = "put" then syncfile(put,FolderOrFile1,FolderOrFile2); endif;
		if tolower(type) = "get" then syncfile(get,FolderOrFile1,FolderOrFile2); endif;
		syncdisconnect();
		errmsg(message);
	else
		errmsg("Error in the process, please try again!!!");
	endif;
end;

function  ClientDropBox(string Type, string FolderOrFile1, string FolderOrFile2, string message); 
	//this function allows you to transfer via Dropbox. Type takes the values get or put, FolderOrFile1 is depending on whether type is get or put, source or destination folder
	if syncconnect(Dropbox) then		
		if tolower(type) = "put" then syncfile(put,FolderOrFile1,FolderOrFile2); endif;
		if tolower(type) = "get" then syncfile(get,FolderOrFile1,FolderOrFile2); endif;
		syncdisconnect();
		errmsg(message);
	else
		errmsg("Error in the process, please try again!!!");
	endif;
end;


function receive_assign()
	close(FOLLOW_DICT);
	filedelete("../REF/follow.dat.csidx");
	syncserver(Bluetooth);
end;

function transfer_assign()
	close(FOLLOW_DICT);
	//Assignments are transfered thru bluetooth
	ClientBluetooth("Put", "../REF/follow.dat", "../REF/", TR("Assignments successfully transferred to interviewer"));
end;


function transfer_data()
	//the investigator transfers his entire DATA file previously zipped by bluetooth to the controller
	//the supervisor transfers its entire DATA folder by dropbox
	
	if accreditation = "interviewer" then //transfer thru bluetooth
		//we first zip its DATA folder and copy it into the WORK folder 
		compress("../WORK/DATA.zip","../DATA/*");
		syncserver(Bluetooth);
		
	elseif accreditation = "supervisor" then //transfer on Dropbox server
		compress("../WORK/DATA"+OperatorCode+".zip","../DATA/*");
		filecopy("../REF/follow.dat","../REF/follow_" + OperatorCode +".dat");
		compress("../WORK/REF"+OperatorCode+".zip","../REF/follow_" + OperatorCode +".dat");
		if syncconnect(Dropbox) then
			syncfile(put,"../WORK/DATA"+OperatorCode+".zip","LFS/DATA/"); //transfer data
			syncfile(put,"../WORK/REF"+OperatorCode+".zip","LFS/REF/"); //transfer Assignments

			syncfile(GET,"LFS/ENTRY/entry*.zip","../ENTRY/"); //Receive update
				if fileexist("../ENTRY/entry.zip") then //unzippe the update
					decompress("../ENTRY/entry.zip","../ENTRY/"); 
					filedelete("../ENTRY/entry.zip");	
				endif;
			syncdisconnect();
	    	errmsg("Data transfer completed successfully!!!"); 	    	
		else
			errmsg("Error in the process, please resume!!!");
		endif;		
	endif;

end;


function receive_data()
	
	filedelete("../WORK/DATA.zip");
	filedelete("../WORK/AgentCode.dat");
	close(LFS_DICT);
	if syncconnect(Bluetooth) then	
		//Before receive data, the program check that the interviewer who is sending data is in the same team than the supervisor
		syncfile(Get,"../REF/AgentCode.dat","../WORK/AgentCode.dat");
		setfile(tempfile, "../WORK/AgentCode.dat");
		string text;
		fileread(tempfile,text);
		close(tempfile);
		
		if text[1:2] + "0" = operatorCode then
			syncfile(Get,"../WORK/DATA.zip","../WORK/");
			decompress("../WORK/DATA.zip","../DATA/");
			syncdisconnect();
			errmsg("Data copied successfully");
		else
			errmsg("You are connected to interviewer %s who is not in your team. Data will not be trasnfered",text);			
			syncdisconnect();
		endif;
			
	else
		errmsg("Error in the process, please try again!!!");
	endif;	
		
end;  


function receive_data_coordo()
	

	if syncconnect(dropbox) then

		syncfile(GET,"LFS/DATA/DATA*.zip","../DATA/");
		syncfile(GET,"LFS/REF/REF*.zip","../REF/");
		
		list string listFiles;
		//unzip downloaded .zip
		dirlist(listFiles,"../DATA","*.zip");
		do i = 1 while i<= listFiles.length()
			decompress(listFiles(i));
			filedelete(listFiles(i));
		enddo;
		
		dirlist(listFiles,"../REF","*.zip");
		do i = 1 while i<= listFiles.length()
			decompress(listFiles(i));
			filedelete(listFiles(i));
		enddo;
		
	else
		errmsg(tr("Error in the process, please try again !!!"));
	endif;		
		
end;

function receive_update()
//You can receive the update either by bluetooth or on the server

i = accept("How would you like to receive the update?","1-From Dropbox","2-Thru bluetooth");

	if i = 0 then //nothing has been selected
		reenter;
	elseif i = 2 then //superior bluetooth reception
		syncserver(Bluetooth);
	elseif i = 1 then
		if syncconnect(Dropbox) then
			syncfile(GET,"LFS/ENTRY/entry*.zip","../ENTRY/"); //Receive update
				if fileexist("../ENTRY/entry.zip") then //unzip the update file
					decompress("../ENTRY/entry.zip","../ENTRY/"); 
					filedelete("../ENTRY/entry.zip");	
				endif;
			syncdisconnect();
	    	errmsg("Update received successfully!!!"); 	    	
		endif;		
	endif;
	
end;

function transfer_update()
//the transfer of the update is done by the supervisor thru bluetooth to the interviewer
	if accreditation = "supervisor" then
		clientBluetooth("put","../ENTRY/*.pen","../ENTRY/",tr("Update transferred successfully"));
	endif;
end;


function usb()
	if getos() in 10:19 then //we are trying to automatically detect the USB key inserted on the machine
	    som = 0;
		string CleUSB = "GHIJKLMNOP";
		do varying i = 1 while i <= length(CleUSB) 
			if direxist(concat(CleUSB[i:1], ":/")) then 
				floppy = concat(CleUSB[i:1],":");
				som = som + 1;
			endif;
		enddo;
		if Som = 0  then errmsg("You inserted no USB/SDcard, Please insert one for transfert");  
			reenter;
		endif;  
		if som >= 2 then errmsg("You inserted more than one USB/SDcard or your disk is partitioned"); 
			i = accept("Please select the name of USB/FLASH DRIVE","D:","E:","F:","G:","H:","I:","J:","K:","L:","M:","N:","O:","P:");
			
			if i > 0 then floppy = CleUSB[i:1] + ":"; else reenter; endif;
		endif;		
	elseif getos() in 20:29 then //we are trying to detect the sdcard in the tablet
	    if !direxist(sdcard) then errmsg("You have not inserted any SDcard, please insert one for operation");
	    else 
	    	som = 1 ; //i.e we found sdcard
	    	if pourTablette = "sdcard" then floppy = sdcard; endif;
	    	if pourTablette = "sdcard1" then floppy = sdcard1; endif;  	
	    endif; 
 	endif;
end; 

function Backup()

//We first save in the BACKUP of the machine
  string repertoire = strip(wrkprj);

	string destination =  concat(strip(repertoire), strip(slash), "BACKUP", strip(slash),OperatorCode + " Day_" + edit("99999999", sysdate("DDMMYYYY"))+ " Hour_" + edit("999999",systime()));

	dircreate(destination); //create the backup directory on the machine
	dircreate(destination + slash + "DATA");
	dircreate(destination + slash + "REF");
	
	OK = FileCopy( concat(strip(repertoire),strip(slash),"DATA",strip(slash),"*"), strip(destination + slash + "DATA"));
	OK = OK + FileCopy( concat(strip(repertoire),strip(slash),"REF",strip(slash),"*"), strip(destination + slash + "REF"));

  	if ok then errmsg("Local backup successfully completed"); endif;
 	
//then we make a backup on an external medium
	pourTablette = "sdcard1";
	usb();
	if som >= 1 then
		if !DirExist(concat(strip(floppy), strip(slash), "BACKUP")) then DirCreate(concat(strip(floppy), strip(slash), "BACKUP")); endif;
		string destination2 =  concat(strip(floppy), strip(slash), "BACKUP", strip(slash),OperatorCode + " Day_" + edit("99999999", sysdate("DDMMYYYY"))+ " Hour_" + edit("999999",systime()));
		dircreate(destination2); //we create the backup directory on the USB key
		dircreate(destination2 + slash + "DATA");
		dircreate(destination2 + slash + "REF");	
		OK = FileCopy( concat(strip(repertoire),strip(slash),"DATA",strip(slash),"*"), strip(destination2 + slash + "DATA"));
		OK = OK + FileCopy( concat(strip(repertoire),strip(slash),"REF",strip(slash),"*"), strip(destination2 + slash + "REF"));

	  	if ok and som >=1 then errmsg("Backup successfully completed on the USB key/SdCard"); endif;
	endif;

	  	if !som then errmsg("The Backup was not made on a USB key/SdCard"); endif;
	 	
end;

 function SummaryOfAssignment()
 	string reportFilename = "..\REPORTS\Assignments.html"; 	
	setfile(tempFile, reportFilename, create);
	// Standard HTML headers
	filewrite(tempFile, "<!DOCTYPE html>");
	filewrite(tempFile, "<html><head>");
	
	// Add CSS to make tables look nice
	filewrite(tempFile, "<style type='text/css'>");
	filewrite(tempFile, "table, th, td {border: 1px solid black;border-collapse: collapse;padding: 8px}");	
	filewrite(tempFile, "</style>");
	filewrite(tempFile, "<title>Resume of Assignments </title>");
	filewrite(tempFile, "</head>");
	filewrite(tempFile, "<body>");
	// Id-items
	filewrite(tempFile, "<h2><font color = blue>Resume of Assignments</font></h2>");

    nbHHAssigned.clear();
	
    //we go through lines 1 to 1 and load the recap table of assignments
	close(SAMPLE_DICT);
	setfile(SAMPLE_DICT,"../REF/sample.dat");
	loadcase(SAMPLE_DICT,CNULSAMP);
	
    do i=1 while XNUMBER(i) > 0
		nbHHAssigned(XINTCODE(i)) = nbHHAssigned(XINTCODE(i)) + 1;
    enddo;
    
    //we write the result in html
    filewrite(tempFile, "<p> Cluster : %07d %s</p>", CNULSAMP,getlabel(CNULSAMP,CNULSAMP));
	filewrite(tempFile, "<p>Number of households in the cluster : %d</p>",i-1);
	filewrite(tempFile, "<p><font color = blue>Table 1 : Summary of Assignments by interviewer</font></p>");
	filewrite(tempFile, "<table>");
	filewrite(tempFile, "<tr><th>Interviewer code</th><th>Intervierwer name</th><th>Number of households assigned</th><th>Estimated individuals</th></tr>");
	som = 0;

	
	valset.clear();
	valset.add("Not yet assigned",0);
	do i = 0 while i<= 9 //in case of a maximum of 9 interviewers per team
		if getlabel(USERCODE,USERCODE+i) <> "" then
			valset.add(getlabel(USERCODE,USERCODE+i),USERCODE+i);
		endif;
	enddo;
	
	do k= 1 while k <= length(valset.codes);
			x= valset.codes(k);
			filewrite(tempFile, "<tr>");
			filewrite(tempFile, "<td>%03d</td>", x);
			filewrite(tempFile, "<td>%s</td>", getlabel(valset, x));
			filewrite(tempFile, "<td>%d</td>", nbHHAssigned(x));
			filewrite(tempFile, "<td>%d</td>", sum(XSIZE where XSIZE<95 AND XINTCODE = x));
			filewrite(tempFile, "</tr>");
			som = som + (k>1)*nbHHAssigned(x); //this allows to have the total number of households assigned. K = 1 correspond of non assigned households
	enddo;	 	
 
 	filewrite(tempFile, "</table>");

    	filewrite(tempFile, "<p><font color = blue> Table 2 : Detail of Assignments</font></p>");
		filewrite(tempFile, "<table>");
		filewrite(tempFile, "<tr><th>Line</th><th>HH name</th><th>HH Phone</th><th>HH Size</th><th>Interviewer</th></tr>");
		do n= 1 while XNUMBER(n) >= 0
			
			filewrite(tempFile, "<tr>");
			filewrite(tempFile, "<td>%d</td>", n);
			filewrite(tempFile, "<td>%s</td>", strip(XNAME(n)));
			filewrite(tempFile, "<td>%d</td>", XPHONE(n));
			filewrite(tempFile, "<td>%d</td>", XSIZE(n));
			string color2;
			if XINTCODE(n) = 0 then color2 = "red" else color2 = "black" endif;
			
			filewrite(tempFile, "<td><font color = %s>%s</font></td>",color2, getlabel(valset, XINTCODE(n)));
			filewrite(tempFile, "</tr>");			       
   		 enddo;    	
 		filewrite(tempFile, "</table>");    

	filewrite(tempFile, "</body>");
	filewrite(tempFile, "</html>");
	close(tempFile);
	if getos() in 20:29 then
		// Android - use "browse:"
		execsystem(maketext("view:%s", reportFilename));
	else
		// Windows - use "explorer.exe <filename>"
		execsystem(maketext("%sexplorer.exe %s", 
						    pathname(Windows), 
						    reportFilename));
	endif;
   
   end;

function DisplayOnMap()
	//this function will display the points on the map, maps.me for android and google earth for windows
	Setfile(tempfile, wdir + slash + "KML" + edit("9999999",CNULSAMP)+ ".kml");
	
	filewrite(tempfile,'<?xml version="1.0" encoding="UTF-8"?>');
	filewrite(tempfile,'<kml xmlns="http://earth.google.com/kml/2.0">');
	filewrite(tempfile,'<Document>');
	filewrite(tempfile,'<name>Cluster %07d </name>',cnulsamp);

	setfile(SAMPLE_DICT,"../REF/sample.dat");
	loadcase(SAMPLE_DICT,cnulsamp); //we load the sample households of the current cluster

	do i = 1 while !special(XNUMBER(i)) //we count all the lines of the sample file

		filewrite(tempfile,'<Placemark>');	
			if getos() in 20:29 then //on android
				filewrite(tempfile,"<name>NAME : %s. Num %d</name>",strip(XNAME(i)),i);
				filewrite(tempfile,'<description>HH</description>');
				filewrite(tempfile,'<styleUrl>#placemark-red</styleUrl>');

			else //on windows
				filewrite(tempfile,"<name></name>");
				filewrite(tempfile,'<description>NAME : %s. Num %d</description>',strip(XNAME(i)),i);
				//we will color the cluster points in green and the sampled points in red
				string couleur2 = "FF0000FF"; //else couleur2 = "FF00FF00"; endif;
				filewrite(tempfile,'<Style><IconStyle><scale>0.6</scale><Icon><href>http://maps.google.com/mapfiles/kml/shapes/shaded_dot.png</href></Icon><color>%s</color></IconStyle></Style>',couleur2);
			endif;
			filewrite(tempfile,'<Point>');
			filewrite(tempfile,"<coordinates>%5.6f, %5.6f </coordinates></Point>",XLONGITUDE(i),XLATITUDE(i));
		filewrite(tempfile,'</Placemark>');

	enddo;

	filewrite(tempfile,'</Document>');
	filewrite(tempfile,'</kml>');	
	close(tempfile);
	
	if getos() in 20:29 then
		execsystem("view:" + filename(tempfile));
	elseif getos() in 10:19 then
		TheCommand = concat( '"', strip(goog), '\googleearth.exe" ','"',wdir + slash + "KML" + edit("9999999",CNULSAMP)+ ".kml",'"' );
		ExecSystem( strip(TheCommand),nowait, maximized, focus );
	endif;
	
end;

function MergeFiles()
	//this function will be a sub-function of the functions DetailedResult, WorkProgress
	//It allows you to create work files, merged as needed
	
	close(LFS_DICT);close(FOLLOW_DICT);close(SAMPLE_DICT);
	STRING prefixe;
	
	if accreditation = "supervisor" then
		prefixe = OperatorCode[1:2]
	elseif  accreditation = "interviewer" then
		prefixe = OperatorCode
	endif;
	fileconcat(LFS_DICT,"../WORK/MALL.csdb","../DATA/M" + prefixe + "*.csdb"); 
	
	Setfile(LFS_DICT,"../WORK/MALL.csdb",append);
	setfile(FOLLOW_DICT,"../REF/follow.dat",append);
	setfile(SAMPLE_DICT,"../REF/sample.dat");

end;

function export_data()
	close(LFS_DICT);close(FOLLOW_DICT);close(SAMPLE_DICT);
	fileconcat(LFS_DICT,"../WORK/MALL.csdb","../DATA/M*.csdb"); 
	execpff("../EXPORT/EXPORT.pff");
	errmsg("Open the folder %s and double click on file MASTER.sps and run it.",pathname(application)[1:length(pathname(application))-6] + "SPSS");
	errmsg("In the MASTER.sps, update the line cd depending of your path");
	errmsg("If you want to export in Stata, open the folder %s and run the 2 do file HH.do and IND.do",pathname(application)[1:length(pathname(application))-6] + "EXPORT");
	VIEW("../SPSS/MASTER.sps");
end;

function DetailedResult()

	//Cette fonction permet de donner le code résultat de chaque questionnaire entamé 

	MergeFiles();
	
 	string reportFilename = maketext("%sDetailedResult.html", "..\REPORTS\");

	setfile(tempFile, reportFilename,create);

	// Standard HTML headers
	filewrite(tempFile, "<!DOCTYPE html>");
	filewrite(tempFile, "<html><head>");
	
	// Add CSS to make tables look nice
	filewrite(tempFile, "<style type='text/css'>");
	filewrite(tempFile, "table, th, td {border: 1px solid black;border-collapse: collapse;padding: 8px}");	
	filewrite(tempFile, "</style>");
	filewrite(tempFile, "<title>Detailed results</title>");
	filewrite(tempFile, "</head>");
	filewrite(tempFile, "<body>");
	filewrite(tempFile, "<h2><font color = BLUE >RESULTS OF EACH QUESTIONNAIRE OF CLUSTER %d %s</font></h2>",CNULSAMP,getvaluelabel(CNULSAMP));


//Table 	
	
	if countcases(LFS_DICT) > 0 then // we check that there are household data
		
		filewrite(tempFile, "<table>");
		filewrite(tempFile, "<tr><th>Line</th><th>Cluster</th><th>HH number</th><th>HH head</th><th>HH size</th><th>Result</th><th>Status</th><th>Interviewer</th><th>Supervisor</th></tr>");
		
		numeric line = 0;
		forcase LFS_DICT WHERE HH1 = CNULSAMP do 
			inc(line);
			color1 = "red";
			result1 = getvaluelabel(HH11);
			
			if HH11 = 1 and BADCLOSEDHH = 1 then
				color1 = "black";
			elseif HH11 in notappl then
				result1 = "in progress";
			endif;
			
			filewrite(tempFile, "<tr style = 'color:%s'>", color1);
			filewrite(tempFile, "<td>%d</td>",LINE);
			filewrite(tempFile, "<td>%04d</td>",HH1);
			filewrite(tempFile, "<td>%02d</td>",HH2);
			filewrite(tempFile, "<td>%s</td>",strip(HH5A));
			filewrite(tempFile, "<td>%d</td>",HHSize);
			filewrite(tempFile, "<td>%s</td>",result1);
			filewrite(tempFile, "<td>%s</td>",getvaluelabel(BADCLOSEDHH));
			filewrite(tempFile, "<td>%03d %s</td>",HH3,getlabel(userCode_VS1,HH3));
			filewrite(tempFile, "<td>%03d %s</td>",HH4,getlabel(userCode_VS1,HH4));
			filewrite(tempFile, "</tr>");
		endfor;
		filewrite(tempFile, "</table>");
	endif;

	filewrite(tempFile, "</body></html>");
	close(tempFile); 
	
 	if getos() in 20:29 then
		// Android - use "browse:"
	// string	reportFilename = fileconcat(strip(report),strip(slash),"error.HTML",strip(report),strip(slash),);
		execsystem(maketext("view:%s", reportFilename));
	else
		// Windows - use "explorer.exe <filename>"
		execsystem(maketext("%sexplorer.exe %s", 
						    pathname(Windows), 
						    reportFilename));
	endif;		
end;

 

function WorkProgress()
	//This function is used to give the statistics on the data files

	MergeFiles(); 
	
	
	//Calculate stats

	hashmap statsHH(numeric,numeric) default(0) ; //(ea, result). result = -1 for assignment, 
	hashmap statsInd(numeric,numeric) default(0) ; //(ea, result). result = -1 for expected, 
	
	//stats about expected households. 
		//for the supervisor the expected household are in the sample.dat file
		//for the interviewer the expected household are in the follow.dat file
	list listOfClusters; 
	
	if accreditation = "supervisor" then
		forcase SAMPLE_DICT where XSUP = usercode do
			statsHH(XCLUSTER,-1) = count(XNUMBER where XNUMBER>0); //-1 is for assignment
			inc(statsHH(0,-1),count(XNUMBER where XNUMBER>0)); //0 is for the total
			listOfClusters.add(XCLUSTER); 
		endfor;
	elseif accreditation = "interviewer" then
		forcase FOLLOW_DICT where FINTCODE = usercode do
			inc(statsHH(FCLUSTER,-1)); //-1 is for assignment
			inc(statsHH(0,-1)); //0 is for the total
			listOfClusters.add(FCLUSTER); 
		endfor;
	endif;

	//Stats about result of hh survey
	forcase LFS_DICT do
		numeric res;
		if HH11 = 96 then
			res = 10
		elseif HH11 = notappl then
			res = 9
		else 
			res = HH11
		endif;
		inc(statsHH(HH1,res)); inc(statsHH(0,res)); inc(statsHH(HH1,0)); inc(statsHH(0,0)); //0 is for the total
		inc(statsHH(HH1,20),XGPS in 3,notappl); inc(statsHH(0,20),XGPS in 3,notappl); //20 is the position where we want save the number of HH without GPS coordinates. You can choose another value in place of 20
		inc(statsHH(HH1,21),BADCLOSEDHH=0); inc(statsHH(0,21),BADCLOSEDHH=0); 
		
		inc(statsIND(HH1,-1),count(HL6 where HL6>=5)); //-1 is for expected indiv
		inc(statsIND(0,-1),count(HL6 where HL6>=5)); //0 is for the total
		inc(statsIND(HH1,0),count(II8 where II8 in 1,2)); //0 is for the total started in the cluster
		
		//WE TRY to match the result of individual with result of hh
		for i in SECT_IND
			IF hL6(i) >= 5 then 
				recode II9 -> res;
						1  -> 1;
						2  -> 2;
						3  -> 4;
					4,notappl  -> 9;
						5  -> 11;
						6  -> 5;
						96  -> 10;
				endrecode;
				inc(statsIND(HH1,res));inc(statsIND(0,res)); inc(statsIND(0,0),II8 in 1,2); //inc(statsIND(HH1,0),II8 in 1,2);
			endif;
		endfor;
		
		//stats on temporary code of activities and occupation
		numeric NbTempCode = count(EMP16A where EMP16A = 0) +  count(CM2B where CM2B = 0) +  count(CM3C where CM3C = 0) +  count(CS1B where CS1B = 0) +  count(CS2B where CS2B = 0) + count(OPA2A where OPA2A = 0);
		inc(statsIND(HH1,22),NbTempCode);inc(statsIND(0,22),NbTempCode);
	endfor;
	
	//write all the calculated statistics in an html file
 	string reportFilename = maketext("%sWorkProgress.html", "..\REPORTS\");

	setfile(tempFile, reportFilename,create);
	
	// Standard HTML headers
	filewrite(tempFile, "<!DOCTYPE html>");
	filewrite(tempFile, "<html><head>");
	
	// Add CSS to make tables look nice
	filewrite(tempFile, "<style type='text/css'>");
	filewrite(tempFile, "table, th, td {border: 1px solid black;border-collapse: collapse;padding: 8px}");	
	filewrite(tempFile, "</style>");
	filewrite(tempFile, "<title>Progress report</title>");
	filewrite(tempFile, "</head>");
	filewrite(tempFile, "<body>");
	filewrite(tempFile, "<h2><font color = BLUE >Progress report</font></h2>"); 	
	
	listOfClusters.add(0);  //0 is for the total
	listOfClusters.removeDuplicates();
	listOfClusters.sort();
	
	filewrite(tempfile,"<table>");
		//write the headings of the table
		filewrite(tempfile,"<tr>");
			filewrite(tempfile,"<th>Line</th>");
			filewrite(tempfile,"<th>Cluster</th>");
			IF accreditation = "supervisor" then filewrite(tempfile,"<th>Sup</th>"); else filewrite(tempfile,"<th>Interv</th>"); endif;
			filewrite(tempfile,"<th>Quest</th>");
			filewrite(tempfile,"<th>Expected</th>");
			filewrite(tempfile,"<th>Started</th>");
			filewrite(tempfile,"<th>Completed</th>");
			filewrite(tempfile,"<th>No member</th>");
			filewrite(tempfile,"<th>HH absent</th>");
			filewrite(tempfile,"<th>Refused</th>");
			filewrite(tempfile,"<th>Postponed</th>");
			filewrite(tempfile,"<th>Dwelling vacant</th>");
			filewrite(tempfile,"<th>Dwelling destroyed</th>");
			filewrite(tempfile,"<th>Dwelling not found</th>");
			filewrite(tempfile,"<th>Partially</th>");
			filewrite(tempfile,"<th>Other</th>");
			filewrite(tempfile,"<th>Incapacitated</th>");
			filewrite(tempfile,"<th>Missing GPS</th>");
			filewrite(tempfile,"<th>Bad closed</th>");
			filewrite(tempfile,"<th>Temporary codes</th>");
		filewrite(tempfile,"</tr>");
	
		//write the content of the cells of the table
		numeric line = 0;
		do i = 1 while i<= listOfClusters.length()
			numeric clust = listOfClusters(i);
			inc(line); string colorr;
			if line%2 = 0 then colorr = "style = 'background-color: pink'"; else colorr = ""; endif;
			filewrite(tempfile,"<tr %s>",colorr);
				filewrite(tempfile,"<td rowspan = '2'>%d</td>",line);
				if clust = 0 then filewrite(tempfile,"<td rowspan = '2'>TOTAL</td>"); else filewrite(tempfile,"<td rowspan = '2'>%07d</td>",clust); endif;
				filewrite(tempfile,"<td rowspan = '2'>%03d %s</td>",usercode,getvaluelabel(usercode));
				
				//stats for household
				filewrite(tempfile,"<td>Household</td>");
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,-1)); //expected
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,0)); //Started
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,1)); //Completed
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,2)); //No member
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,3)); //HH absent
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,4)); //Refused
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,5)); //Postponed
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,6)); //Dwelling vacant
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,7)); //Dwelling destroyed
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,8)); //Dwelling not found
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,9)); //Partially
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,10)); //Other
				filewrite(tempfile,"<td>-</td>");//,statsHH(clust,11)); //incapacitated
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,20)); //Missing GPS
				filewrite(tempfile,"<td>%d</td>",statsHH(clust,21)); //Bad closed
				// filewrite(tempfile,"<td>%d</td>",statsHH(clust,22)); //Temporary codes
				filewrite(tempfile,"<td> - </td>"); //Temporary codes
			filewrite(tempfile,"</tr>");	

			filewrite(tempfile,"<tr %s>",colorr);	
				//stats for individual
				filewrite(tempfile,"<td>Individual</td>");
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,-1)); //expected
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,0)); //Started
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,1)); //Completed
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,2)); //No member
				filewrite(tempfile,"<td>-</td>");//,statsIND(clust,3)); //HH absent
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,4)); //Refused
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,5)); //Postponed
				filewrite(tempfile,"<td>-</td>");//,statsIND(clust,6)); //Dwelling vacant
				filewrite(tempfile,"<td>-</td>");//,statsIND(clust,7)); //Dwelling destroyed
				filewrite(tempfile,"<td>-</td>");//,statsIND(clust,8)); //Dwelling not found
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,9)); //Partially
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,10)); //other
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,11)); //Incapacitated
				filewrite(tempfile,"<td>-</td>");//,statsIND(clust,20)); //Missing GPS
				filewrite(tempfile,"<td>-</td>");//,statsIND(clust,21)); //Bad closed
				filewrite(tempfile,"<td>%d</td>",statsIND(clust,22)); //Temporary codes
			filewrite(tempfile,"</tr>");	
		enddo;
	
	
	
	
	
	filewrite(tempfile,"</table>");
	
// Close html file
	filewrite(tempFile, "</body></html>");
	close(tempFile); 
	
 	if getos() in 20:29 then
		// Android - use "browse:"
	// string	reportFilename = fileconcat(strip(report),strip(slash),"error.HTML",strip(report),strip(slash),);
		execsystem(maketext("view:%s", reportFilename));
	else
		// Windows - use "explorer.exe <filename>"
		execsystem(maketext("%sexplorer.exe %s", 
						    pathname(Windows), 
						    reportFilename));
	endif;		
end;



function listingMen()
	//this function is a sub-function of the error listing function, it deals with household errors. 
	//The LAST 3 lines of this function are very IMPORTANT
	list string listErr;
	listErr.clear();
	listErr.add(maketext("<P><font color = BLUE >Cluster = %07d %s, HHNumber = %02d, HH Head = %s, Interviewer = %03d %s </font></P>", HH1,getlabel(cnulsamp_vs1,HH1),HH2,strip(HH5A),HH3,getlabel(USERCODE_VS1,HH3)));

//section HH
	for i in HH5B do
		STRING phone = maketext("%d",HH5B);
		
		if HH5B <> 0 then
			if !(length(phone) in 7,9) or phone[1:1] in "0","1" then
				listErr.add(maketext(100,i,HH5B));
			endif;		
		endif;
	endfor;
	
//section HL
	for cur in SECT_HL
		
		if HL6 < 18 and  HL8 in 2:4 then
			listErr.add(maketext(101,cur,strip(HL2(cur)),HL6,getvaluelabel(HL8)));
		endif;		

		IF HL3(cur) = 2 and HL8 in 1,4 then
			listErr.add(maketext(111,cur,strip(HL2(cur)),getvaluelabel(HL8),getlabel(HL3,HL3(cur))));	
		endif;
			
		if HL6 < 20 and HL4 = 1 and  HL9 = 2 then
			listErr.add(maketext(102,cur,strip(HL2),HL6,getvaluelabel(HL9)));
		endif;

		if cur = 1 and count(HL3 where HL3 = 2 ) >= 2 and HL9 = 1 then
			listErr.add(maketext(112,cur,strip(HL2(cur)),getvaluelabel(HL9),count(HL3 where HL3 = 2 )));
		endif;
		
		if HL3(cur) = 2 and HL9 <> HL9(1) then
			listErr.add(maketext(113,cur,strip(HL2(cur)),getvaluelabel(HL9),getlabel(HL9,HL9(1))));
		endif;


		if cur = 1 then //control the minimum age of household head
			if HL6(1) < 15 then
				listErr.add(maketext(103,HL6(1)));
			elseif HL6(1) < 18 then
				listErr.add(maketext(103,HL6(1)));
			endif;
		elseif cur > 1 then //control on the difference of age between the son, grand son, parent, grandparent and hh head
			if 	   (HL3 = 3 and HL6(1) - HL6 < 15) 
				or (HL3 = 5 and HL6(1) - HL6 < 30) 
				or (HL3 = 6 and HL6 - HL6(1) < 15) 
				or (HL3 = 8 and abs(HL6 - HL6(1)) > 20) 
				or (HL3 = 16 and HL6 - HL6(1) < 30) 
			then
				listErr.add(maketext(104,cur,strip(HL2),HL6,getvaluelabel(HL3),HL6(1), abs(HL6(1) - HL6)  ));
			endif;
		
		endif;	

		if cur > 1 and HL4(1) = 1 then //check that son/daughter are same ethnicity of male hh head
			if HL3(cur) = 3 and HL11 <> HL11(1) then
				listErr.add(maketext(105,cur,strip(HL2),getvaluelabel(HL11),getvaluelabel(HL3),getvaluelabel(HL11(1))));
			endif;
		endif;
		
	endfor;

//section MIG
	for cur in SECT_MIG

		if !( pos("A",HL10(cur)) <=> ischecked("A",MIG8)) then
			listErr.add(maketext(107,cur,strip(MIG2(cur))));
		endif;		


		if !(ischecked("M", HL10(cur)) <=> ischecked("C",MIG8))  then
			listErr.add(maketext(108,cur,strip(MIG2(cur))));
		endif;


		if !(poschar("BCDEFGHIJKL", STRIP(HL10(cur)))>0 <=> ischecked("B",MIG8)) then
			listErr.add(maketext(109,cur,strip(MIG2(cur))));
		endif;


		string nat = "BCDEFGHIJKL";
		string text = "";
		
		do i = 1 while i <= length(nat)
			string xi = nat[i:1];
			if !(ischecked( xi,HL10(cur)) <=> ischecked( xi,MIG9) ) then
			
				text = text + getlabel(HL10_VS1,xi) + ",";
			endif;
		enddo;
		
		if text <> "" then
			listErr.add(maketext(110,cur,strip(MIG2(cur)),text));
		endif;



		
	endfor;
	
//Section Employment	
	for cur in SECT_IND
	//detection of temporary codes on activity or occupation
		if EMP16A = 0 then
			listErr.add(maketext(701,cur,strip(II5B),"EMP16A",getlabel(EMP16A),strip(EMP16)));
		endif;	

		if CM2B = 0 then
			listErr.add(maketext(701,cur,strip(II5B),"CM2B",getlabel(CM2B),strip(CM2) + ". " + strip(CM2A)));
		endif;	

		if CM3C = 0 then
			listErr.add(maketext(701,cur,strip(II5B),"CM3C",getlabel(CM3C),strip(CM3) + ". " + strip(CM3B)));
		endif;	
		
				
		IF testAgeOccu(HL6(II5A),CM3C) then
			listErr.add(maketext(201,II5A,strip(II5B),HL6(II5A),getvaluelabel(CM3C)));
		endif;


		IF testEduOccu(ED3L(II5A),CM3C) then
			listErr.add(maketext(202,II5A,strip(II5B),getvaluelabel(CM3C),Getvaluelabel(ED2(II5A)),Getvaluelabel(ED5L(II5A)),Getvaluelabel(ED3L(II5A))));
		endif;
				
		
		
		if CS1B = 0 then
			listErr.add(maketext(701,cur,strip(II5B),"CS1B",getlabel(CS1B),strip(CS1) + ". " + strip(CS1A)));
		endif;	

		if CS2B = 0 then
			listErr.add(maketext(701,cur,strip(II5B),"CS2B",getlabel(CS2B),strip(CS2) + ". " + strip(CS2A)));
		endif;	


		IF testAgeOccu(HL6(II5A),CS2B) then
			listErr.add(maketext(203,II5A,strip(II5B),HL6(II5A),getvaluelabel(CS2B)));
		endif;

		IF testEduOccu(ED3L(II5A),CS2B) then
			listErr.add(maketext(204,II5A,strip(II5B),getvaluelabel(CS2B),Getvaluelabel(ED2(II5A)),Getvaluelabel(ED5L(II5A)),Getvaluelabel(ED3L(II5A))));
		endif;


		if CM27 <> 1 and CM27 <> notappl and CM10 in 1,5,6 then
			listErr.add(maketext(205,II5A,strip(II5B),getvaluelabel(CM10), getvaluelabel(CM27) ));
		endif;

		if CM27A <> 1 and CM27A <> notappl and CM10 in 1,5,6 then
			listErr.add(maketext(206,II5A,strip(II5B),getvaluelabel(CM10), getvaluelabel(CM27A) ));
		endif;

		if CM28 <> 1 and CM28 <> notappl and CM10 in 1,6 then
			listErr.add(maketext(207,II5A,strip(II5B),getvaluelabel(CM10), getvaluelabel(CM28) ));
		endif;

		if CM29 <> 1 and CM29 <> notappl and CM10 in 1,5,6 then
			listErr.add(maketext(208,II5A,strip(II5B),getvaluelabel(CM10), getvaluelabel(CM29) ));
		endif;

		if pos("A",CM11)=0 and CM10 in 5 then
			listErr.add(maketext(209,II5A,strip(II5B),getvaluelabel(CM10) ));
		endif;


		if OPA2A = 0 then
			listErr.add(maketext(701,cur,strip(II5B),"OPA2A",getlabel(OPA2A),strip(OPA2)));
		endif;	
	endfor;
	

	if XGPS in 3,notappl then
		listErr.add(maketext(702));
	endif;		

//We write in the error file	
	if listErr.length() > 1 then //we add in the tempfile only the households that have errors
		filewrite(tempFile,listErr);
	endif;	
end;


function ErrorListing()
	// This function will produce an html file that contains potentials errors in the data file
	
	string reportFilename = maketext("%sErrorListing.html", "..\REPORTS\");

	setfile(tempFile, reportFilename,create);

	// Standard HTML headers
	filewrite(tempFile, "<!DOCTYPE html>");
	filewrite(tempFile, "<html><head>");
	
	// Add CSS to make tables look nice
	filewrite(tempFile, "<style type='text/css'>");
	filewrite(tempFile, "table, th, td {border: 1px solid black;border-collapse: collapse;padding: 8px}");	
	filewrite(tempFile, "</style>");
	filewrite(tempFile, "<title>Error listing</title>");
	filewrite(tempFile, "</head>");
	filewrite(tempFile, "<body>");


	numeric nbquest ;
			
	nbquest = accept(maketext("Do you want to list errors for only one questionnaire or for all the questionnaires of the cluster %d",CNULSAMP), 
						"1 - Only one questionnaire",
						maketext("2 - All the questionnaires of cluster %d", CNULSAMP));
	
	//Preparing working files
	MergeFiles();
	
	//Starting to write errors
	
		filewrite(tempFile, "<h2><font color = BLUE >ERROR LISTING</font></h2>");
		
		if nbQuest = 1 then //only one questionnaire
			ok = selcase("Please select a household",LFS_DICT,"")
					where HH1 = CNULSAMP
					include (HH2,HH5A,HH11);
			if ok = 0 then
				errmsg("You have not selected anything");
				reenter;
			else
				listingMen();
			endif;
		elseif nbQuest = 2 then //all the questionnaires
			forcase LFS_DICT where HH1 = CNULSAMP do 
				listingMen();
			endfor;
		endif; 


	// Closing html file
	filewrite(tempFile, "</body></html>");
	close(tempFile); 
	
 	if getos() in 20:29 then
		// Android - use "browse:"
		execsystem(maketext("view:%s", reportFilename));
	else
		// Windows - use "explorer.exe <filename>"
		execsystem(maketext("%sexplorer.exe %s", 
						    pathname(Windows), 
						    reportFilename));
	endif;		
end;

function ControlCodes()
	string reportFilename = maketext("%sControlCode.html", "..\REPORTS\");

	setfile(tempFile, reportFilename,create);

	// Standard HTML headers
	filewrite(tempFile, "<!DOCTYPE html>");
	filewrite(tempFile, "<html><head>");
	
	// Add CSS to make tables look nice
	filewrite(tempFile, "<style type='text/css'>");
	filewrite(tempFile, "table, th, td {border: 1px solid black;border-collapse: collapse;padding: 8px}");	
	filewrite(tempFile, "</style>");
	filewrite(tempFile, "<title>Control codes</title>");
	filewrite(tempFile, "</head>");
	filewrite(tempFile, "<body>");

	
	filewrite(tempFile, "<h2><font color = BLUE >CONTROL ISIC AND ISCO CODES for cluster %07d</font></h2>",cnulsamp);
	
	//Preparing working files
	MergeFiles();
	
	numeric line = 0;
	filewrite(tempFile, "<table>");
	filewrite(tempFile, "<tr><th>Line</th><th>Interviewer</th><th>Cluster</th><th>HHnum</th><th>Indiv</th><th>ITEM</th><th>Type</th><th>Description</th><th>Code</th></tr>");
	
		FORCASE LFS_DICT where HH1 = cnulsamp do
			for i in SECT_IND do
				
				if EMP16A >= 0 then
					inc(line);
					filewrite(tempFile, "<tr><td>%d</td><td>%03d</td><td>%07d</td><td>%02d</td><td>%02d</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>",line,HH3,HH1,HH2,i,"EMP16A",getlabel(EMP16A),strip(EMP16),getvaluelabel(EMP16A));
				endif;	
				
				if CM2B >= 0 then
					inc(line);
					filewrite(tempFile, "<tr><td>%d</td><td>%03d</td><td>%07d</td><td>%02d</td><td>%02d</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>",line,HH3,HH1,HH2,i,"CM2B",getlabel(CM2B),strip(CM2) + ". " + strip(CM2A),getvaluelabel(CM2B));
				endif;

				if CM3C >= 0 then
					inc(line);
					filewrite(tempFile, "<tr><td>%d</td><td>%03d</td><td>%07d</td><td>%02d</td><td>%02d</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>",line,HH3,HH1,HH2,i,"CM3C",getlabel(CM3C),strip(CM3) + ". " + strip(CM3B),getvaluelabel(CM3C));
				endif;

				if CS1B >= 0 then
					inc(line);
					filewrite(tempFile, "<tr><td>%d</td><td>%03d</td><td>%07d</td><td>%02d</td><td>%02d</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>",line,HH3,HH1,HH2,i,"CS1B",getlabel(CS1B),strip(CS1) + ". " + strip(CS1A),getvaluelabel(CS1B));
				endif;

				if CS2B >= 0 then
					inc(line);
					filewrite(tempFile, "<tr><td>%d</td><td>%03d</td><td>%07d</td><td>%02d</td><td>%02d</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>",line,HH3,HH1,HH2,i,"CS2B",getlabel(CS2B),strip(CS2) + ". " + strip(CS2A),getvaluelabel(CS2B));
				endif;


				if OPA2A >= 0 then
					inc(line);
					filewrite(tempFile, "<tr><td>%d</td><td>%03d</td><td>%07d</td><td>%02d</td><td>%02d</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>",line,HH3,HH1,HH2,i,"OPA2A",getlabel(OPA2A),strip(OPA2),getvaluelabel(OPA2A));
				endif;

			endfor;
			
		endfor;
	filewrite(tempFile, "</table>");

	// Closing html file
	filewrite(tempFile, "</body></html>");
	close(tempFile); 
	
 	if getos() in 20:29 then
		// Android - use "browse:"
		execsystem(maketext("view:%s", reportFilename));
	else
		// Windows - use "explorer.exe <filename>"
		execsystem(maketext("%sexplorer.exe %s", 
						    pathname(Windows), 
						    reportFilename));
	endif;		
end;

function ReadQuestionnaire()
	// This function will produce an html file that contains the printed questionnaire
	
	string reportFilename = maketext("%sReadQuestionnaire.html", "..\REPORTS\");

	setfile(tempFile, reportFilename,create);

	// Standard HTML headers
	filewrite(tempFile, "<!DOCTYPE html>");
	filewrite(tempFile, "<html><head>");
	
	// Add CSS to make tables look nice
	filewrite(tempFile, "<style type='text/css'>");
	filewrite(tempFile, "table, th, td {border: 1px solid black;border-collapse: collapse;padding: 8px}");	
	filewrite(tempFile, "</style>");
	filewrite(tempFile, "<title>Read questionnaire</title>");
	filewrite(tempFile, "</head>");
	filewrite(tempFile, "<body>");


	//Preparing working files
	MergeFiles();
	
	//Starting to write questionnaire int html
	
		filewrite(tempFile, "<h2><font color = BLUE >READING QUESTIONNAIRE</font></h2>");
		
		ok = selcase("Please select a household",LFS_DICT,"")
				where HH1 = CNULSAMP
				include (HH2,HH5A,HH11);
		if ok = 0 then
			errmsg("You have not selected anything");
			reenter;
		else
		filewrite(tempFile,"<p><font color = blue>Household information</font></p>");
		filewrite(tempFile,"<table>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH1","Cluster",HH1);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH2","Household number",HH2);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%03d %s</td></tr>","HH3","Interviewer",HH3,getlabel(usercode,hh3));
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%03d %s</td></tr>","HH4","Supervisor",HH4,getlabel(usercode,hh4));
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH5A","HH name",HH5A);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l <br> %l <br> %l</td></tr>","HH5B","Household head's contact number",HH5B(1),HH5B(2),HH5B(3));
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH6","Date of interview",HH6);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH7","Area",HH7);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH8","LGA",HH8);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%d</td></tr>","HH9","Start time of household interview",HH9);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH10","Consent",HH10);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH11","Result of household questionnaire",HH11);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH11X","Other result",HH11X);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH13","HOUSEHOLD SOURCES OF LIVELIHOOD",HH13);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH13X","Other source",HH13X);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH14","HOUSEHOLD MAIN SOURCE OF LIVELIHOOD",HH14);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HH12","End time for household interview",HH12);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","HHSIZE","Household size",HHSIZE);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","XGPS","Collect GPS",XGPS);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%5.6f</td></tr>","LON","Longitude",LON);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%5.6l</td></tr>","LAT","Latitude",LAT);
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%d</td></tr>","ALT","Altitude",ALT);

			filewrite(tempFile,"</table>");
			
			filewrite(tempFile,"<p><font color = blue>Individual information</font></p>");

			filewrite(tempFile,"<table>");
		
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL1","Line number"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL2","Name"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL3","Relationship"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL3X","Other relationship"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL3X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL4","Sex"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL5D","Day of birth"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",HL5D(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL5M","Month of birth"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL5M(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL5Y","Year of birth"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",HL5Y(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL6","Age"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",HL6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL8","Marital status"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL9","Type of union"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL10","Nationality"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL10(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL11","Ethnicity"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL11(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL11X","Other ethnicity"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL11X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL12","Religion"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL12(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HL12X","Other religion"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HL12X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","HHMORE","Add another member"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",HHMORE(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED1","Line number"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED2","Ever attended school"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED3L","Highest level attained"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED3L(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED3G","Number of years completed"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED3G(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED4","Currently attending school"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED5L","Current level"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED5L(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED5G","Current year"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED5G(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED6","Reason for never attended school"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED6X","Other reason"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED6X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED7","Can read and write"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED8","Field out of study"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ED9","Attende any course in 4 last weeks"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ED9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR1","Line number"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR2","Name"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR3","Attended a training course in the last 12 months"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR4","Sector of training"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR5","Name of training course"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR6","Main sponsor for the training"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR6X","other sponsor"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR6X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR7","Training part of regular work"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",TR7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR8","Training completed"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","TR9","Training duration in month"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",TR9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM1","Line number"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",IM1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM2","Name"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",IM2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM3","Duration in year of living in the village/town/city"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",IM3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM4","Initial LGA"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",IM4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM4X","Initial country"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",IM4X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM5","Main reason for moving"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",IM5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM5X","Other main reason"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",IM5X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM6","LGA of birth"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",IM6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","IM6X","Country of birth"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",IM6X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG1","Line number"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG2","Name"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG3","Born in Gambia"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG4","Birth country"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG5M","Arrival month in Gambia"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG5M(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG5Y","Arrival year in Gambia"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",MIG5Y(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG6","Duration in Gambia"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG7","Main reason for moving to Gambia"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG7X","Other reason"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG7X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG8","Citizen of"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","MIG9","Other country of citizen"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",MIG9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","FN1","Line number"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",FN1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","FN2","Name"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",FN2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","FN3","Difficulty seeing"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",FN3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","FN4","Difficulty hearing"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",FN4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","FN5","Difficulty walking"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",FN5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","FN6","Difficulty remembering"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",FN6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","FN7","Difficulty washing"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",FN7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","FN8","Difficulty comminicating"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",FN8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","II5A","Line number"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",II5A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","II5B","Name"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",II5B(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","II6","Date of individual interview"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",II6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","II7","Start time of individual interview"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",II7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","II8","Individual consent"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",II8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","II9","Result of individual interview"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",II9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","II9X","Other result"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",II9X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","II10","End time of individual interview"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",II10(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP4","Last week, from last (Monday) up to (Sunday), did (you/NAME) work for someone else for pay, for one or more hours?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP5","Last week, did (you/NAME) run or do any kind of business, farming or other activity to generate income?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP6","Last week, did (you/NAME) help in a family business or farm?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP7","(Do/does) (you/NAME) have a paid job or income generating activity, but (were/was) did not work last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP8","Why were you absent from your work in the last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP8X","Other reason(s)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP8X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP9","Including the time that (you/NAME) (have/has) been absent, will (you/he/she) return to that same job or business in 3 months or less?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP10","(Do/Does) (you/NAME) continue to receive an income from (your/his/her) job or business during this absence?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP10(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP11","During the low or off-season, (do/does) (you/NAME) continue to do some work for that job or business?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP11(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP12","Last week, did (you/NAME) do any work in… ?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP12(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP13","Was this work that you mentioned in…?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP13(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP14","Thinking about the work in (farming, rearing animals [and/or fishing]) (you/NAME) (do/does), are the products intended…… ?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP14(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP15","(Were/Was) (you/NAME) hired by someone else to do this work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP15(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP16","What are the main products from (farming, rearing animals, [and/or fishing]) that (you/NAME) was/were working on?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP16(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP16A","ISIC CODE"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EMP16A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP17","Last week, on how many days did (you/NAME) do this work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",EMP17(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EMP18","How many hours per day did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",EMP18(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM1","Last week did you have more than one job or business?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM1A",getlabel(CM1A)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM1A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM2","Main activity of the establishment or business"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM2A","Main goods or services produced"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM2A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM2B","ISIC CODE"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM2B(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM3","Occupational title"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM3B","Main tasks and duties"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM3B(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM3C","ISCO CODE"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM3C(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM5","(Do/does) (you/NAME) work…?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM6","Who usually makes the decisions about the running of the family business?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM7","Does the business hire any paid employees on a regular basis?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM8","Does more than half of (your/his/her) income from the [business/activity] come from … ?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM9","Do you get your customers, clients or buyers through someone else, for example from another company, intermediary or person?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM9B1",getlabel(CM9B1)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM9B1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM9B2",getlabel(CM9B2)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM9B2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM9B3",getlabel(CM9B3)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM9B3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM9B4",getlabel(CM9B4)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM9B4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM9B5",getlabel(CM9B5)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM9B5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM9B6",getlabel(CM9B6)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM9B6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM10","In this job (are/is) (you/he/she) working in….?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM10(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM11","Which of the following types of pay (do/does) (you/NAME) receive for this work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM11(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM11X","Other cash payment"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM11X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM12","Who pays (you/NAME) for that work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM12(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM12X","Other payer"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM12X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM13","(Do/does)(you/NAME) have a written contract or oral agreement for the work (you/he/she) (do/does)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM13(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM14","Does your contract or agreement specify the number of hours (you/he/she) (are/is) supposed to work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM14(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM15","Are/Is) (you/NAME) at least guaranteed that (you/he/she) will get some work or hours in your job?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM15(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM16","What are (your/NAME’s) agreed or contractual working hours per week in this job?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",CM16(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM17","Is (your/NAME’s) contract or agreement….?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM17(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM18","How long in total is (your/NAME’s) current agreement?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM18(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM19","Which of the following applies to (your/NAME’s) current agreement?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM19(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM20","Are/Is) (you/NAME) on a probation period to get a permanent contract?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM20(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM21","Is (your/NAME’s) work seasonal?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM21(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM22","Employer pay contributions to the pension fund"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM22(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM23","Do/Does) (you/NAME) get paid annual leave?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM23(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM24","Would (you/NAME) get paid sick leave in case of illness or injury?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM24(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM25","In what kind of place (do/does) (you/NAME) typically work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM25(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM26","How many persons including (you/NAME) work at (your/NAME) place of work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM26(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM27","Is the business (you/NAME) work(s) for registered with GRA (GAMBIA Revenue Authority?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM27(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM27A",getlabel(CM27A)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM27A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM28",getlabel(CM28)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM28(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM29","What kind of accounts or records does the business keep? Are they…"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM29(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM30","Which year did (you/NAME) begin working in this business or place?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",CM30(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CM31","And which month?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CM31(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS1","Main activity of secondary job"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS1A","Goods or services produced"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS1A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS1B","ISIC CODE"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS1B(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS2","What is your work/ occupation in this job?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS2A","Main tasks and duties"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS2A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS2B","ISCO CODE"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS2B(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS3","In this second job, (do/does) (you/NAME) work…?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS4","Does the business hire any paid employees on a regular basis?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS5","Does more than half of (your/his/her) income from the [business/activity] come from … ?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS6","Do you get your customers, clients or buyers through someone else, for example from another company, intermediary or person?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS71",getlabel(CS71)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS71(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS72",getlabel(CS72)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS72(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS73",getlabel(CS73)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS73(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS74",getlabel(CS74)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS74(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS75",getlabel(CS75)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS75(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS76",getlabel(CS76)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS76(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS8","Which of the following types of pay (do/does) (you/NAME) receive for this work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","CS8X","Other type of pay"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",CS8X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT1","How many hours (do/does) (you/NAME) usually work per week in (your/his/her) main job?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",WKT1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT2","In total, how many hours did (you/NAME) actually work in (your/his/her) main job last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",WKT2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT3","How many hours (do/does) (you/NAME) usually work per week in (your/his/her) second job?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",WKT3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT4","How many hours did (you/NAME) actually work last week in (your/his/her) second job?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",WKT4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT5","Did you have any other jobs last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT6","How many hours (do/does) (you/NAME) usually work per week in all (your/his/her) other job(s)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",WKT6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT7","How many hours did (you/NAME) actually work last week in all (your/his/her) other job(s)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",WKT7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT8A","TOTAL HOURS USUALLY WORKED IN ALL  JOB(S) (WKT1+WKT3+WKT6)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT8A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT8B","TOTAL HOURS ACTUALLY WORKED IN ALL JOB(S) (WKT2+WKT4+WKT7)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT8B(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT9","During the last four weeks, that is from [DATE] up to [last DAY/yesterday] did (you/NAME) look for additional or other paid work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT10","Would (you/NAME) want to work more hours per week than usually worked, provided the extra hours are paid?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT10(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT11","Could (you/NAME) start working more hours within the next two weeks?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT11(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT12","How many additional hours per week could (you/NAME) work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",WKT12(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT13","To what extent are you satisfied with your main job?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT13(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT14","Do/Does) (you/NAME) want to change (your/his/her) current employment situation?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT14(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT15","What is the main reason why (you/NAME) want(s) to change (your/his/her) employment situation?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT15(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WKT15X","Other reason"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WKT15X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPA1","READ: The next questions are about unpaid work in farming or fishing that (you/NAME) may have done for your household or family. That is not to sell"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPA1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPA2","What are the main (animals, farming, and/or [fishing]) products that (you/NAME) (are/is) working on for the family?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPA2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPA2A","ISIC CODE"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPA2A(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPA3","Number of days"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPA3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPA4","How many hours per day did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPA4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI1","The last time you were paid in your main job, were you paid in cash such as salaries, wages, commissions, bonuses or tips?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI2","How much did you receive the last time you were paid?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI3","What period did this payment cover?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI3X","Other period"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI3X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI4","How many days did you work in your main job during that period?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI5","On average, how many hours did you work per day in your main job during that period?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI6","Does your employer provide you with …?(Please write all that apply)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI6X","Other"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI6X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI7","If one had to purchase those products, how much would they have cost? (Please round up)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI8","Did you have to pay any amount to receive these goods?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI9","How much did you pay? (Please round up)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI10","Last month, how much did you receive in additional income or earnings from any secondary activity(regular,occasional/exceptional, etc.)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI10(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI11","Last month, how much did you make in net profit, from your main business or activity?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI11(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI12","Last month, did you take any products from your main business or activity for the household’s own use?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI12(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI13","If one had to purchase those products, how much would they have cost?(Please round up)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI13(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EI14","Last month, how much did you receive in additional income or earnings from any secondary activity (regular, occasional/ exceptional, etc.)? (Please estimate the total for all secondary activities,and round up)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EI14(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS1","During the last 4 weeks, that is from [DATE] up to last week, did you look for a jobor try to start a business?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS2","Or did you try to do anything to find any kind of work to generate income, even if small or casual jobs?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS3","What did you do in the last 4 weeks to find a job or try to start a business? Interviewer: READ. Please record only the main job search activity)"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS3X","OTHERS. What did you doin the last 4 weeks to find a job or try to start a business?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS3X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS4","Even though you did not look for work in the last 4 weeks, do you want to work for pay or profit?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS5","What was the Main reason why you did not seek work or try to start a business during the last 4 weeks?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS5X","OTHERS. What was the Main reason why you did not seek work or try to start a business during the last 4 weeks?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS5X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS6","How long have you been without work and trying to find a job or start a business?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS7","If a job or business opportunity had been available, could (you/NAME) have started working last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS7B","Could (you/NAME) start working within the next two weeks?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS7B(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS8","What is the main reason why you do not want or you are not available to work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS8X","OTHERS. What is the main reason why you do not want or you are not available to work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS8X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","JS9","At any time in the last 12 months, that is since [MO] up to last month, did (you/NAME) look for a paid job or try to start a business?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",JS9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG1","Last week, did (you/NAME) you gather wild food such as [mushrooms, herbs...]?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPG1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG2","How many hours did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPG2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG3","Last week, did (you/NAME) go hunting for [bush meat...]?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPG3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG4","How many hours did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPG4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG5","Last week, did (you/NAME) prepare preserved food or drinks for storage such as [flour, dried fish, butter, cheese...]?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPG5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG6","How many hours did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPG6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG7","Last week, did (you/NAME) do any construction work to build, renovate or extend the family home or help a family member with similar work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPG7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG8","How many hours did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPG8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG9","Last week, did (you/NAME) spend any time making goods for use by your household or family such as [mats, baskets, furniture, clothing,..]?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPG9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG10","How many hours did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPG10(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG11","Last week, did (you/NAME) fetch water from natural or public sources for use by your household or family?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPG11(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG12","How many hours did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPG12(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG13","Last week, did (you/NAME) collect any firewood [or other natural products] for use as fuel by your household or family?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPG13(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG14","How many hours did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPG14(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG15","In the last 4 weeks from [START DATE] up to [last END DAY/yesterday] did (you/NAME) participate in any unpaid apprenticeship, internship or similar training in a work place?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",OPG15(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","OPG16","How many hours did (you/NAME) spend doing this last week?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%d</td>",OPG16(i)); enddo; filewrite(tempFile,"</tr>");
{			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H1","Carrying or pushing or pulling heavy loads?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H2","Working where (you/NAME) have to climb high off the floor/ground, from where if (you/NAME) fell, (you/NAME) might be injured?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H3","Using powered tools (electric or gas)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H4","Using sharp tools?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H4(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H5","Using big or heavy machines, or driving vehicles?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H5(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H6","Working with fire, ovens or very hot machines or tools, or unsafe electric wires/cables, where (you/NAME) might get burned?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H6(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H7","Working in very a noisy place, so that (you/NAME) had to shout to speak"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H7(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H8","Working indoors or outdoors where dust, sand, smoke or fumes make it hard to breathe or see clearly?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H8(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H9","Working in a place that is very cold, or working outdoors in very rainy or wet weather?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H9(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H10","Working long hours in the hot sun without a break?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H10(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H11","Working below the ground in mining wells or tunnels or other very small spaces?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H11(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H12","Working underwater?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H12(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H13","Working with or around agricultural chemicals? Or helping someone else to do this"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H13(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H14","Working with liquids or powders that irritate your skin, burn easily, give off vapours that smell bad or can explode?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H14(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H15","Working during the night-time or very early in the morning, when it is dark?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H15(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H16","Working in contact with large domestic animals"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H16(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H17","Doing the same task over and over again at a fast pace for long hours?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H17(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H18","Do (you/NAME) generally feel safe at work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H18(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H19","Have (you/NAME) ever been punished for mistakes made at work?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H19(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H20","Would (you/NAME) be allowed to leave your workplace if (you/NAME) were very ill, injured, had a serious family problem or wanted to quit?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H20(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H21","Sometimes people at work can hurt children and adolescents physically. Thinking about yourself in the work (you/NAME) (.....) anything else to hurt (you/NAME) physically?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H21(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H22","Who did this to (you/NAME)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H22(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H23","Sometimes, when children and adolescents are at work people say or do things that scare them or make them worry about their safety. Since you’ve worked at this job, has anyone at work ever threatened to hurt (you/NAME)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H23(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H24","Who did this to (you/NAME)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H24(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H25","Sometimes when children and adolescents are at work people say or do things to make them feel bad. Since you’ve worked in this job, has anyone at work ridiculed (you/NAME), insulted (you/NAME) or made (you/NAME) feel ashamed?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H25(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","H26","Who did this to (you/NAME)?"); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",H26(i)); enddo; filewrite(tempFile,"</tr>");
}
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EBR1",getlabel(EBR1)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EBR1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EBR1X",getlabel(EBR1X)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EBR1X(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","EBR2",getlabel(EBR2)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",EBR2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WPA1",getlabel(WPA1)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WPA1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","WPA2",getlabel(WPA2)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",WPA2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ATT1",getlabel(ATT1)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ATT1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","ATT2",getlabel(ATT2)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",ATT2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","SPR1",getlabel(SPR1)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",SPR1(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","SPR2",getlabel(SPR2)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",SPR2(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td>","SPR3",getlabel(SPR3)); do i = 1 while i<= Hhsize filewrite(tempFile,"<td>%l</td>",SPR3(i)); enddo; filewrite(tempFile,"</tr>");
			filewrite(tempFile,"<tr><td>%s</td><td>%s</td><td>%l</td></tr>","BADCLOSEDHH","Bad closed",BADCLOSEDHH);
		filewrite(tempFile,"</table>");

		endif;
 


	// Closing html file
	filewrite(tempFile, "</body></html>");
	close(tempFile); 
	
 	if getos() in 20:29 then
		// Android - use "browse:"
		execsystem(maketext("view:%s", reportFilename));
	else
		// Windows - use "explorer.exe <filename>"
		execsystem(maketext("%sexplorer.exe %s", 
						    pathname(Windows), 
						    reportFilename));
	endif;		
end;

PROC MENU_FF


preproc
setfont(valuesets, "Arial", 20, bold);
temp = "../ENTRY/";


 if getos() in 10:19 then //windows
  slash = "\";
 elseif getos() in 20:29 then //android
   slash = "/"; 
 endif;

  wrkprj = pathname(application)[1:length(pathname(application))-length(slash + "ENTRY")-1]; 

if !DirExist("../BACKUP") then DirCreate("../BACKUP"); endif;
if !DirExist("../DATA") then DirCreate("../DATA"); endif;
if !DirExist("../WORK") then DirCreate("../WORK"); endif;
if !DirExist("../REPORTS") then DirCreate("../REPORTS"); endif;
sdcard1 = pathname(CSEntryExternal);
sdcard = pathname(CSEntryExternal)[1:pos("/Android",pathname(CSEntryExternal))];
reportt = "..\REPORTS\";
wdir = wrkprj + "\WORK";


goog  = concat( "C:", strip(slash), "Program Files\Google\Google Earth Pro\client" );
if fileexist(concat( "C:", strip(slash), "Program Files (x86)\Google\Google Earth\client\googleearth.exe" )) then //pour prendre en compte la machine de pierro
goog  = concat( "C:", strip(slash), "Program Files (x86)\Google\Google Earth\client" );
endif;

PROC MENU_LEVEL_FORM

PROC USERCODE

preproc

	string DateVersionApplication = edit("99999999999999",publishdate());

	//We will write the agent code in a file named AgentCode.dat that we will store in the REF folder
	if !fileexist("../REF/AgentCode.dat") then
		warning("Hello! You are login into the LFS application.\nPlease select your name from this list to proceed with the configuration.");	
	else
		setfile(FileAgentCode,"../REF/AgentCode.dat");
		fileread(FileAgentCode,AgentCode); //we retrieve the agent code found on the first line of the AgentCode.dat file
		$ = tonumber(strip(AgentCode));
		close(FileAgentCode);
		noinput;
	endif;

onfocus

	setproperty("DisplayCodesAlongsideLabels","YES");
	
postproc

	//Since a tablet must have a single user, if the agent who had already logged in modifies his account, he is forced to bring back the first account with which he logged in
	if fileexist("../REF/AgentCode.dat") then
		setfile(FileAgentCode,"../REF/AgentCode.dat");
		fileread(FileAgentCode,AgentCode); //we retrieve the agent code found on the first line of the AgentCode.dat file
		$ = tonumber(strip(AgentCode));
		close(FileAgentCode);
	endif;


	//when you log in for the first time, you save the agent code 	
	if !fileexist("../REF/AgentCode.dat") then 
		
		OK = accept(maketext("You have selected %s . If it's you, click on CONTINUE; otherwise click on MODIFY",getvaluelabel(userCode)),"CONTINUE","MODIFY"); 
		if OK = 1 then
			if usercode = 0 then
				password = prompt("Enter the password",password);
				if tolower(password) <> "gambia" then
					errmsg("Wrong password, please correct");
					reenter;
				endif;
			endif;
			setfile(FileAgentCode,"../REF/AgentCode.dat",create); 
			filewrite(FileAgentCode,edit("999",$));
			close(FileAgentCode);
		else
			reenter;
		endif;
	endif;

	
	//the agent is told the version of the application he is working with
	errmsg("..........LFS MENU 2024...............\nHello %s.\nYou are working with the Application version of %s/%s/%s at %sh%smin%ss",getvaluelabel(userCode), DateVersionApplication[7:2],DateVersionApplication[5:2],DateVersionApplication[1:4],DateVersionApplication[9:2],DateVersionApplication[11:2],DateVersionApplication[13:2]);
	

	//we create working variable accreditation and OperatorCode
	if usercode  = 0 then
		accreditation = "coordo";
	elseif edit("999",userCode)[3:1] = "0" then
		accreditation = "supervisor";
	else
		accreditation = "interviewer";
	endif;

	OperatorCode = edit("999",$);

PROC CNULSAMP
	
ONFOCUS
	//We want each participant to see only the Cluster that have been assigned to him

	valset.clear();

	close(SAMPLE_DICT); close(FOLLOW_DICT); 
	filedelete("../REF/sample.dat.csidx");filedelete("../REF/follow.dat.csidx");
	setfile(SAMPLE_DICT,"../REF/sample.dat"); setfile(FOLLOW_DICT,"../REF/follow.dat",append);
	
	if accreditation = "supervisor" then
		forcase SAMPLE_DICT do
			if XSUP = userCode then
				valset.add(getlabel(cnulsamp_VS1,Xcluster),XCLUSTER);
			endif;
		endfor;
	elseif accreditation = "interviewer"  then 
		hashmap tt(numeric) default(0);
		forcase FOLLOW_DICT do
			if FINTCODE = userCode and tt(FCLUSTER)=0 then
				valset.add(getlabel(cnulsamp_VS1,FCLUSTER),FCLUSTER);
				tt(FCLUSTER) = 1;
			endif;
		endfor;	
	endif;
	
	if length(valset.codes) = 0 then
		//this means that the interviewer have not yet received Assignments from the supervisor
		skip to GOPT;
	else
		setvalueset($,valset);
	endif;
	
PROC GOPT
	
onfocus
	OperatorMenu1();

postproc
		
	if $ = 7 then 
		close(LFS_DICT); close(FOLLOW_DICT);  close(SAMPLE_DICT);   

		backup();
		reenter; 
	endif;
	
	if $ = 8 then  reenter CNULSAMP; endif;
	if $ = 9 then  stop(1); endif;	

	
PROC OPTION

onfocus
OperatorMenu();

postproc


if $ = 2 then //Assign HOUSEHOLD 
	close(FOLLOW_DICT); close(SAMPLE_DICT);
	genpff1("SAMPLE");
	runpff("SAMPLE");
	reenter;	
elseif $ = 3 then //Point on Assignment
	SummaryOfAssignment();
	reenter GOPT ;	
ELSEif $ = 11 then //saisir Quest Menage
	close(LFS_DICT); close(FOLLOW_DICT); close(SAMPLE_DICT);
	op_select();
	close(LFS_DICT); close(FOLLOW_DICT); close(SAMPLE_DICT);

	genpff3("LFS");
	runpff("LFS");	
	reenter;
	
elseif $ = 30 then	//transfer Assignment
	transfer_assign();
	reenter GOPT ;
elseif $ = 31 then	//receive Assignments
	receive_assign();		
	stop(1);
	reenter GOPT ;
elseif $ = 32 then	//transfer data (supervisor transfer on dropbox and interviewer transfer thru bluetooth
	close(FOLLOW_DICT); close(LFS_DICT); close(SAMPLE_DICT);
	transfer_data();
	stop(1);//we close the application after the data transfer because we also receive the update there
	reenter GOPT ;	
elseif $ = 33 then	//supervisor receive data
	IF accreditation = "coordo" then
		receive_data_coordo();
	else //supersvisor
		receive_data(); 
	endif;
	reenter;
elseif $ = 34 then	//Supervisor Transfer update to interviewer thru bluetooth
	transfer_update();
	reenter;
elseif $ = 35 then	//receive update
	receive_update();
	stop(1);//we close the application after receiving the update
	reenter;
	
elseif $ = 36 then	//export data to spss and stata
	export_data();
	reenter;
	
elseif $ = 50 then //Error listing
	ErrorListing(); 
	reenter GOPT ;
	
elseif $ = 51 then //Control ISIC and ISCO codes
	ControlCodes(); 
	reenter GOPT ;
	
elseif $ = 52 then //Detailed result
	
	DetailedResult();
	reenter;
	
elseif $ = 53 then //Work progress
	WorkProgress();
	reenter GOPT ;
	
elseif $ = 54 then //Read questionnaire
	ReadQuestionnaire();
	reenter GOPT ;
	
elseif $ = 60 then //Show cluster sample households
	DisplayOnMap();
	reenter GOPT ;		
	
elseif $ = 90 then
	stop(1);
else
	reenter;
endif;


 
